# üéØ GI·∫¢I TH√çCH CHI TI·∫æT C√ÅC KH√ÅI NI·ªÜM DI CHO NG∆Ø·ªúI M·ªöI

## ü§î "DEPENDENCY" L√Ä G√ç?

### üìö Kh√°i ni·ªám c∆° b·∫£n
**Dependency** c√≥ nghƒ©a l√† **"s·ª± ph·ª• thu·ªôc"**. Khi m·ªôt class c·∫ßn s·ª≠ d·ª•ng m·ªôt class kh√°c ƒë·ªÉ ho·∫°t ƒë·ªông, th√¨ n√≥ **ph·ª• thu·ªôc** v√†o class ƒë√≥.

### üîç V√≠ d·ª• th·ª±c t·∫ø t·ª´ d·ª± √°n
```java
// BookController ph·ª• thu·ªôc v√†o BookService
@RestController
public class BookController {
    private BookService bookService; // ‚Üê ƒê√¢y l√† DEPENDENCY
    
    public List<Book> getAllBooks() {
        return bookService.getAllBooks(); // C·∫ßn BookService ƒë·ªÉ ho·∫°t ƒë·ªông
    }
}

// BookService ph·ª• thu·ªôc v√†o BookRepository  
@Service
public class BookService {
    private BookRepository bookRepository; // ‚Üê ƒê√¢y c≈©ng l√† DEPENDENCY
    
    public List<Book> getAllBooks() {
        return bookRepository.findAll(); // C·∫ßn BookRepository ƒë·ªÉ ho·∫°t ƒë·ªông
    }
}
```

### üåç V√≠ d·ª• ƒë·ªùi th∆∞·ªùng
- **B·∫°n** ph·ª• thu·ªôc v√†o **ƒëi·ªán tho·∫°i** ƒë·ªÉ g·ªçi ƒëi·ªán
- **Xe h∆°i** ph·ª• thu·ªôc v√†o **ƒë·ªông c∆°** ƒë·ªÉ ch·∫°y
- **Nh√† b·∫øp** ph·ª• thu·ªôc v√†o **b·∫øp gas** ƒë·ªÉ n·∫•u ƒÉn

‚û°Ô∏è **Dependency** = Nh·ªØng th·ª© m√† m·ªôt object c·∫ßn ƒë·ªÉ c√≥ th·ªÉ ho·∫°t ƒë·ªông ƒë∆∞·ª£c!

---

## üîí "IMMUTABLE FIELDS" L√Ä G√å?

### üìö Kh√°i ni·ªám
**Immutable** = **Kh√¥ng th·ªÉ thay ƒë·ªïi**. M·ªôt field immutable nghƒ©a l√† sau khi ƒë∆∞·ª£c g√°n gi√° tr·ªã, kh√¥ng th·ªÉ thay ƒë·ªïi n·ªØa.

### üîß C√°ch t·∫°o Immutable Fields
```java
public class BookService {
    // ‚úÖ IMMUTABLE - D√πng t·ª´ kh√≥a 'final'
    private final BookRepository repository;
    
    // ‚ùå MUTABLE - C√≥ th·ªÉ thay ƒë·ªïi sau khi t·∫°o
    private BookRepository mutableRepository;
    
    public BookService(BookRepository repository) {
        this.repository = repository; // Ch·ªâ ƒë∆∞·ª£c g√°n 1 l·∫ßn
        // this.repository = otherRepo; // ‚ùå L·ªñI! Kh√¥ng th·ªÉ g√°n l·∫°i
    }
    
    public void someMethod() {
        // this.repository = newRepo; // ‚ùå L·ªñI! Kh√¥ng th·ªÉ thay ƒë·ªïi
        this.mutableRepository = newRepo; // ‚úÖ OK - C√≥ th·ªÉ thay ƒë·ªïi
    }
}
```

### üéØ T·∫°i sao n√™n d√πng Immutable?
1. **üõ°Ô∏è An to√†n**: Kh√¥ng ai c√≥ th·ªÉ thay ƒë·ªïi dependency
2. **üêõ √çt bug**: Kh√¥ng c√≥ surprise khi dependency ƒë·ªôt nhi√™n thay ƒë·ªïi
3. **üß† D·ªÖ hi·ªÉu**: Bi·∫øt ch·∫Øc dependency s·∫Ω kh√¥ng ƒë·ªïi
4. **üß™ D·ªÖ test**: Dependencies c·ªë ƒë·ªãnh, d·ªÖ d·ª± ƒëo√°n

### üåç V√≠ d·ª• ƒë·ªùi th∆∞·ªùng
- **S·ªë CMND**: M·ªôt khi ƒë∆∞·ª£c c·∫•p, kh√¥ng th·ªÉ thay ƒë·ªïi (immutable)
- **T√™n cha m·∫π**: ƒê∆∞·ª£c sinh ra v·ªõi t√™n c·ªë ƒë·ªãnh (immutable)
- **M√†u t√≥c**: C√≥ th·ªÉ nhu·ªôm ƒë·ªïi m√†u (mutable)

---

## üè≠ IoC QU·∫¢N L√ù DI NH∆Ø TH·∫æ N√ÄO?

### üìö IoC l√† g√¨?
**IoC (Inversion of Control)** = **ƒê·∫£o ng∆∞·ª£c quy·ªÅn ki·ªÉm so√°t**

**Tr∆∞·ªõc khi c√≥ IoC:**
```java
// Class t·ª± t·∫°o dependencies - T·ª∞ KI·ªÇM SO√ÅT
public class BookService {
    private BookRepository repository;
    
    public BookService() {
        // T·ª± t·∫°o dependency
        this.repository = new BookRepositoryImpl();
        // T·ª± quy·∫øt ƒë·ªãnh d√πng implementation n√†o
    }
}
```

**V·ªõi IoC:**
```java
// Class KH√îNG t·ª± t·∫°o dependencies - KI·ªÇM SO√ÅT B·ªä ƒê·∫¢O NG∆Ø·ª¢C
@Service
public class BookService {
    private final BookRepository repository;
    
    // Spring Container s·∫Ω t·ª± inject dependency
    public BookService(BookRepository repository) {
        this.repository = repository; // Nh·∫≠n t·ª´ b√™n ngo√†i
    }
}
```

### üè≠ Spring Container ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o?

#### 1. üîç **Scan & Discover**
```java
// Spring qu√©t v√† t√¨m c√°c class c√≥ annotation
@Component  // Spring: "Aha! ƒê√¢y l√† m·ªôt bean"
@Service    // Spring: "ƒê√¢y l√† service bean"
@Repository // Spring: "ƒê√¢y l√† repository bean"
@Controller // Spring: "ƒê√¢y l√† controller bean"
```

#### 2. üèóÔ∏è **Create Beans**
```java
// Spring t·∫°o instances c·ªßa c√°c beans
BookRepository bookRepo = new BookRepositoryImpl();
BookService bookService = new BookService(bookRepo); // Inject dependency
BookController bookController = new BookController(bookService);
```

#### 3. üì¶ **Store in Container**
```java
// Spring l∆∞u c√°c beans trong container (nh∆∞ m·ªôt warehouse)
Container = {
    "bookRepository" -> BookRepositoryImpl@123,
    "bookService" -> BookService@456,
    "bookController" -> BookController@789
}
```

#### 4. üéØ **Inject When Needed**
```java
// Khi c·∫ßn inject, Spring l·∫•y t·ª´ container
@Autowired
private BookService bookService; // Spring: "L·∫•y bookService t·ª´ container"
```

### üè≠ V√≠ d·ª• th·ª±c t·∫ø: Nh√† m√°y s·∫£n xu·∫•t xe

**Tr∆∞·ªõc IoC (T·ª± l√†m t·∫•t c·∫£):**
```
C√¥ng nh√¢n A: T√¥i c·∫ßn l√†m b√°nh xe
‚Üí T·ª± ƒëi mua cao su
‚Üí T·ª± l√†m b√°nh xe
‚Üí L·∫Øp v√†o xe

C√¥ng nh√¢n B: T√¥i c·∫ßn l√†m ƒë·ªông c∆°  
‚Üí T·ª± ƒëi mua kim lo·∫°i
‚Üí T·ª± l√†m ƒë·ªông c∆°
‚Üí L·∫Øp v√†o xe
```

**V·ªõi IoC (Nh√† m√°y qu·∫£n l√Ω):**
```
Nh√† m√°y: T√¥i s·∫Ω chu·∫©n b·ªã s·∫µn t·∫•t c·∫£
‚Üí Chu·∫©n b·ªã b√°nh xe
‚Üí Chu·∫©n b·ªã ƒë·ªông c∆°
‚Üí Giao cho c√¥ng nh√¢n khi c·∫ßn

C√¥ng nh√¢n A: "T√¥i c·∫ßn b√°nh xe"
Nh√† m√°y: "ƒê√¢y, b√°nh xe s·∫µn r·ªìi!"

C√¥ng nh√¢n B: "T√¥i c·∫ßn ƒë·ªông c∆°"
Nh√† m√°y: "ƒê√¢y, ƒë·ªông c∆° s·∫µn r·ªìi!"
```

---

## üîó "LOOSE COUPLING" L√Ä G√å?

### üìö Kh√°i ni·ªám
**Coupling** = **S·ª± k·∫øt n·ªëi/ph·ª• thu·ªôc**
- **Tight Coupling** = K·∫øt n·ªëi ch·∫∑t ch·∫Ω (x·∫•u)
- **Loose Coupling** = K·∫øt n·ªëi l·ªèng l·∫ªo (t·ªët)

### üîó Tight Coupling (X·∫§U)
```java
// BookService k·∫øt n·ªëi CH·∫∂T v·ªõi MySQLBookRepository
public class BookService {
    private MySQLBookRepository repository; // B·∫Øt bu·ªôc ph·∫£i d√πng MySQL
    
    public BookService() {
        // T·ª± t·∫°o - kh√¥ng th·ªÉ thay ƒë·ªïi
        this.repository = new MySQLBookRepository();
    }
}

// ‚ùå V·∫§N ƒê·ªÄ:
// - Mu·ªën ƒë·ªïi sang PostgreSQL? KH√îNG TH·ªÇ!
// - Mu·ªën test v·ªõi MockRepository? KH√îNG TH·ªÇ!
// - Mu·ªën d√πng RedisRepository? KH√îNG TH·ªÇ!
```

### üîì Loose Coupling (T·ªêT)
```java
// BookService ch·ªâ ph·ª• thu·ªôc v√†o INTERFACE, kh√¥ng ph·ª• thu·ªôc v√†o implementation c·ª• th·ªÉ
public class BookService {
    private BookRepository repository; // Interface - c√≥ th·ªÉ l√† b·∫•t k·ª≥ implementation n√†o
    
    public BookService(BookRepository repository) {
        this.repository = repository; // Nh·∫≠n t·ª´ b√™n ngo√†i
    }
}

// ‚úÖ L·ª¢I √çCH:
// - Mu·ªën d√πng MySQL? Inject MySQLBookRepository
// - Mu·ªën d√πng PostgreSQL? Inject PostgreSQLBookRepository  
// - Mu·ªën test? Inject MockBookRepository
// - Mu·ªën cache? Inject RedisBookRepository
```

### üåç V√≠ d·ª• ƒë·ªùi th∆∞·ªùng

#### üîó Tight Coupling (K·∫øt n·ªëi ch·∫∑t)
```
B·∫°n mua iPhone ‚Üí Ch·ªâ d√πng ƒë∆∞·ª£c s·∫°c Lightning
iPhone h·ªèng ‚Üí Ph·∫£i mua s·∫°c Lightning m·ªõi
ƒê·∫Øt v√† kh√¥ng linh ho·∫°t
```

#### üîì Loose Coupling (K·∫øt n·ªëi l·ªèng)
```  
B·∫°n mua laptop ‚Üí D√πng c·ªïng USB-C universal
Laptop Dell h·ªèng ‚Üí S·∫°c v·∫´n d√πng ƒë∆∞·ª£c cho laptop HP
Ti·∫øt ki·ªám v√† linh ho·∫°t
```

---

## üéØ V√ç D·ª§ TH·ª∞C T·∫æ TRONG D·ª∞ √ÅN

H√£y xem c√°ch ch√∫ng ta √°p d·ª•ng trong d·ª± √°n Library Management:

### üì± 1. Controller Layer
```java
@RestController
public class BookController {
    // DEPENDENCY: BookController ph·ª• thu·ªôc v√†o BookService
    private final BookService bookService; // IMMUTABLE FIELD
    
    // CONSTRUCTOR INJECTION: IoC Container inject BookService
    public BookController(BookService bookService) {
        this.bookService = bookService;
    }
    
    @GetMapping("/books")
    public List<Book> getAllBooks() {
        // LOOSE COUPLING: Kh√¥ng c·∫ßn bi·∫øt BookService implement nh∆∞ th·∫ø n√†o
        return bookService.getAllBooks();
    }
}
```

### üîß 2. Service Layer  
```java
@Service
public class BookService {
    // DEPENDENCY: BookService ph·ª• thu·ªôc v√†o BookRepository
    private final BookRepository bookRepository; // IMMUTABLE FIELD
    
    // CONSTRUCTOR INJECTION: IoC Container inject BookRepository  
    public BookService(BookRepository bookRepository) {
        this.bookRepository = bookRepository;
    }
    
    public List<Book> getAllBooks() {
        // LOOSE COUPLING: Ch·ªâ bi·∫øt BookRepository interface, 
        // kh√¥ng bi·∫øt implementation c·ª• th·ªÉ (JPA, MongoDB, etc.)
        return bookRepository.findAll();
    }
}
```

### üóÑÔ∏è 3. Repository Layer
```java
// INTERFACE - Gi√∫p t·∫°o LOOSE COUPLING
public interface BookRepository extends JpaRepository<Book, Long> {
    List<Book> findAll();
}

// Spring Data JPA t·ª± ƒë·ªông t·∫°o implementation
// BookService kh√¥ng c·∫ßn bi·∫øt implementation n√†y nh∆∞ th·∫ø n√†o
```

---

## üß™ T·∫†I SAO DI GI√öP D·ªÑ TEST?

### ‚ùå Kh√¥ng c√≥ DI (Kh√≥ test)
```java
public class BookService {
    private BookRepository repository;
    
    public BookService() {
        // T·ª± t·∫°o - lu√¥n k·∫øt n·ªëi database th·∫≠t
        this.repository = new JpaBookRepository();
    }
    
    public List<Book> getAllBooks() {
        return repository.findAll(); // Lu√¥n query database th·∫≠t
    }
}

// Test s·∫Ω ph·∫£i:
// 1. C√†i database
// 2. Chu·∫©n b·ªã data
// 3. Ch·∫°y test r·∫•t ch·∫≠m
```

### ‚úÖ C√≥ DI (D·ªÖ test)
```java
public class BookService {
    private final BookRepository repository;
    
    public BookService(BookRepository repository) {
        this.repository = repository; // Nh·∫≠n t·ª´ b√™n ngo√†i
    }
    
    public List<Book> getAllBooks() {
        return repository.findAll();
    }
}

// Test v·ªõi Mock:
@Test
public void testGetAllBooks() {
    // 1. T·∫°o mock repository
    BookRepository mockRepo = mock(BookRepository.class);
    when(mockRepo.findAll()).thenReturn(Arrays.asList(new Book()));
    
    // 2. Inject mock v√†o service
    BookService service = new BookService(mockRepo);
    
    // 3. Test nhanh, kh√¥ng c·∫ßn database
    List<Book> books = service.getAllBooks();
    assertEquals(1, books.size());
}
```

---

## üéØ T√ìM T·∫ÆT CHO NG∆Ø·ªúI M·ªöI

### üîë C√°c kh√°i ni·ªám c·ªët l√µi:

1. **üß© Dependency**: Nh·ªØng th·ª© m·ªôt class c·∫ßn ƒë·ªÉ ho·∫°t ƒë·ªông
   - BookController c·∫ßn BookService
   - BookService c·∫ßn BookRepository

2. **üîí Immutable Fields**: Kh√¥ng th·ªÉ thay ƒë·ªïi sau khi t·∫°o
   - D√πng t·ª´ kh√≥a `final`
   - An to√†n, √≠t bug

3. **üè≠ IoC Container**: "Nh√† m√°y" qu·∫£n l√Ω t·∫•t c·∫£ objects
   - T·∫°o objects
   - Inject dependencies  
   - Qu·∫£n l√Ω lifecycle

4. **üîì Loose Coupling**: Ph·ª• thu·ªôc v√†o interface, kh√¥ng ph·ª• thu·ªôc implementation
   - D·ªÖ thay ƒë·ªïi
   - D·ªÖ test
   - Linh ho·∫°t

### üéØ L·ª£i √≠ch c·ªßa DI:
- ‚úÖ **D·ªÖ test**: Mock dependencies
- ‚úÖ **D·ªÖ thay ƒë·ªïi**: Swap implementations
- ‚úÖ **√çt bug**: Immutable dependencies
- ‚úÖ **T√°i s·ª≠ d·ª•ng**: C√°c component ƒë·ªôc l·∫≠p
- ‚úÖ **D·ªÖ hi·ªÉu**: R√µ r√†ng v·ªÅ dependencies

### üí° Quy t·∫Øc v√†ng:
1. **Constructor Injection** cho required dependencies
2. **Final fields** ƒë·ªÉ t·∫°o immutable
3. **Interface** thay v√¨ concrete class
4. **ƒê·ª´ng inject ApplicationContext** tr·ª´ khi th·∫≠t s·ª± c·∫ßn

Hy v·ªçng nh·ªØng gi·∫£i th√≠ch n√†y gi√∫p b·∫°n hi·ªÉu r√µ h∆°n v·ªÅ DI! üöÄ
